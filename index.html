<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kouluun pääsyn todennäköisyyslaskuri – GPA (kaikki vuodet)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:#f4f4f4; color:#333; }
    .card { background:#fff; padding:16px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.06); max-width:900px; margin:0 auto; }
    h1 { font-size: 1.25rem; margin-top:0; }
    label { display:block; margin-top:10px; }
    input, select, button { width:100%; padding:12px; margin-top:8px; box-sizing:border-box; font-size:16px; }
    button { background:#0a66ff; color:#fff; border:0; border-radius:8px; margin-top:12px; }
    button:active { transform: translateY(1px); }
    .muted { color:#666; font-size: 0.9rem; }
    #results { margin-top:16px; display:flex; flex-direction:column; gap:8px; }
    .pill { background:#fff; border-left:5px solid #0a66ff; padding:10px 12px; border-radius:8px; }
    .pill strong { display:block; }
    @media (min-width: 720px) {
      .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:end; }
      button { width:auto; padding:12px 18px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Kouluun pääsyn todennäköisyyslaskuri – GPA</h1>
    <p class="muted">Perustuu koulukohtaisiin <em>alimpaan hyväksyttyyn lukuaineiden keskiarvoon</em> (käytetään oletuksena kaikki vuodet; halutessasi voit rajata).</p>

    <div class="grid">
      <div>
        <label for="gpaInput">Syötä lukuaineiden keskiarvosi</label>
        <input type="number" id="gpaInput" step="0.01" placeholder="esim. 8.10" />
      </div>
      <div>
        <label for="windowSelect">Aikajänne laskentaan</label>
        <select id="windowSelect">
          <option value="all" selected>Kaikki vuodet</option>
          <option value="7">Viimeiset 7 vuotta</option>
          <option value="5">Viimeiset 5 vuotta</option>
          <option value="3">Viimeiset 3 vuotta</option>
        </select>
      </div>
    </div>

    <button onclick="calculate()">Laske todennäköisyydet</button>

    <p class="muted" style="margin-top:8px">
      Päivittäminen: lisää uusin vuoden alin hyväksytty keskiarvo kunkin koulun <code>gpas</code>-listan loppuun. Laskuri käyttää automaattisesti kaikki vuodet (tai valitsemasi aikajänteen).
    </p>

    <div id="results"></div>
  </div>

  <script>
    const schools = [
      { name: "Hatanpään/Pyynikin lukio", gpas: [7.67,7.67,7.67,7.83,7.75,7.92,8.00,7.92,8.00,8.00,8.08] },
      { name: "Tampereen teknillisen lukion yleislinja", gpas: [7.58,7.25,7.50,7.58,7.67,7.75,7.83,7.50,7.83,7.67,7.67] },
      { name: "Sammon keskuslukion yleislinja", gpas: [8.00,8.00,8.08,8.25,8.33,8.46,8.62,8.50,8.62,8.67,8.62] },
      { name: "Tammerkosken lukion yleislinja", gpas: [8.23,8.00,7.83,8.00,8.00,8.25,8.33,8.17,8.33,8.09,8.00] },
      { name: "Tampereen klassillisen lukion yleislinja", gpas: [8.38,8.42,8.67,8.83,8.58,8.50,8.75,8.50,8.67,8.17,8.75] },
      { name: "Tampereen lyseon lukion yleislinja", gpas: [8.92,8.15,8.92,8.42,8.92,8.79,9.25,5.33,8.67,8.33,8.83] },
      { name: "Tampereen lyseon lukion IB-linja", gpas: [8.64,8.92,8.79,8.60] },
      { name: "Kalevan lukio", gpas: [8.42,8.5,8.23,8.50,8.54,8.58,8.75,8.58,8.83,8.83,8.75] },
      { name: "Tampereen yhteiskoulun lukio", gpas: [8.42,8.38,8.25,8.36,8.00] },
      { name: "Tampereen yliopiston normaalikoulun lukio", gpas: [7.83,8.00,8.15,8.17,8.62,8.83,8.92,8.69,9.00,9.25,9.25] },
      { name: "Tampereen Steinerkoulun lukio", gpas: [7.00,7.00,7.00,7.00,7.31,7.45,7.54,7.42,7.58,7.33,7.42] },
    ];

    function lastN(arr, n) { return n === "all" ? arr.slice() : arr.slice(-Number(n)); }
    function mean(arr){ return arr.reduce((a,b)=>a+b,0) / arr.length; }
    function stdDev(arr){
      if (arr.length < 2) return 0;
      const m = mean(arr);
      return Math.sqrt(arr.reduce((s,x)=>s+(x-m)*(x-m),0)/arr.length); // populaatiokeskihajonta
    }

    function erf(x) {
      const a1=0.254829592, a2=-0.284496736, a3=1.421413741, a4=-1.453152027, a5=1.061405429, p=0.3275911;
      const sign = x >= 0 ? 1 : -1;
      x = Math.abs(x);
      const t = 1/(1+p*x);
      const y = 1 - (((((a5*t + a4)*t)+a3)*t + a2)*t + a1)*t * Math.exp(-x*x);
      return sign*y;
    }
    function normalCdf(x, mu, sigma){
      if (sigma === 0) return x >= mu ? 1 : 0;
      const z = (x - mu) / (sigma * Math.SQRT2);
      return 0.5 * (1 + erf(z));
    }

    function calculate(){
      const gpa = parseFloat(document.getElementById('gpaInput').value);
      const windowSel = document.getElementById('windowSelect').value;
      const resultsEl = document.getElementById('results');
      resultsEl.innerHTML = "";

      if (isNaN(gpa)){
        resultsEl.innerHTML = `<div class="pill"><strong>Anna kelvollinen keskiarvo.</strong></div>`;
        return;
      }

      const rows = schools.map(s=>{
        const window = lastN(s.gpas, windowSel);
        const mu = mean(window);
        const sd = stdDev(window);
        let p = normalCdf(gpa, mu, sd) * 100;
        p = Math.max(0, Math.min(100, p)); // rajaa 0–100 %
        return { school:s.name, p, n: window.length };
      }).sort((a,b)=>b.p-a.p);

      rows.forEach(r=>{
        const div = document.createElement('div');
        div.className = 'pill';
        div.innerHTML = `<strong>${r.school}</strong>${r.p.toFixed(2)}% <span class="muted">(n=${r.n})</span>`;
        resultsEl.appendChild(div);
      });
    }
  </script>
</body>
</html>
